<!DOCTYPE html>
<html>
<head>
  <title>ระบบรายงานพิกัด</title>
  <meta charset="utf-8" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #map { height: 400px; width: 100%; margin-bottom: 15px; }
    input, textarea, button { margin-bottom: 10px; width: 100%; padding: 8px; }
  </style>
</head>
<body>
  <h2>ฟอร์มรายงานพิกัดแปลงที่ดิน</h2>
  <form id="reportForm">
    <label>ชื่อ:</label>
    <input type="text" name="name" required />

    <label>ปัญหา (เช่น รก, น้ำท่วม, ฯลฯ):</label>
    <textarea name="problem" rows="3"></textarea>

    <label><input type="checkbox" name="no_issue" /> ไม่มีปัญหา รกหรือน้ำท่วม</label>

    <label>พิกัด:</label>
    <input type="text" name="latlng" id="latlng" readonly required />

    <div id="map"></div>

    <button type="submit">ส่งข้อมูล</button>
  </form>

  <script>
    let map, marker;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 13.736717, lng: 100.523186 },
        zoom: 14,
      });

      map.addListener("click", (e) => {
        const latlng = e.latLng;
        if (marker) marker.setMap(null);
        marker = new google.maps.Marker({
          position: latlng,
          map: map,
        });
        document.getElementById("latlng").value = latlng.lat().toFixed(6) + ", " + latlng.lng().toFixed(6);
      });
    }

    document.getElementById("reportForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const form = e.target;
      const data = {
        name: form.name.value,
        problem: form.problem.value,
        no_issue: form.no_issue.checked ? "Yes" : "No",
        latlng: form.latlng.value
      };

      fetch("https://script.google.com/macros/s/YOUR_WEBAPP_URL/exec", {
        method: "POST",
        body: JSON.stringify(data),
        headers: {
          "Content-Type": "application/json"
        }
      })
      .then(res => res.text())
      .then(result => {
        alert("ส่งข้อมูลเรียบร้อย: " + result);
        form.reset();
        if (marker) marker.setMap(null);
        document.getElementById("latlng").value = "";
      })
      .catch(err => {
        console.error(err);
        alert("ส่งข้อมูลไม่สำเร็จ");
      });
    });
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDo19Y656oPz9kcU7qsnjraw8IgmTpkjm4&callback=initMap">
  </script>
</body>
</html>